<Window x:Class="NotiApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Noti" Height="350" Width="300"
        AllowsTransparency="True" WindowStyle="None" Background="Transparent"
        Topmost="True" Deactivated="Window_Deactivated"
        Loaded="Window_Loaded" ResizeMode="CanResizeWithGrip"
        MinWidth="150" MinHeight="120"
        Icon="icon.ico">

    <Window.Resources>
        <Storyboard x:Key="JiggleAnimation">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)">
                <EasingDoubleKeyFrame KeyTime="0:0:0.0" Value="0"/><EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="-5"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="5"/><EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="-3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.4" Value="3"/><EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        
        <Style x:Key="HeaderButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/><Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#404040"/><Setter Property="FontFamily" Value="Segoe UI Symbol"/>
            <Setter Property="FontSize" Value="14"/><Setter Property="Width" Value="30"/><Setter Property="Height" Value="30"/>
            <Setter Property="Template"><Setter.Value><ControlTemplate TargetType="Button"><Border Background="{TemplateBinding Background}" CornerRadius="4"><ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/></Border></ControlTemplate></Setter.Value></Setter>
            <Style.Triggers><Trigger Property="IsMouseOver" Value="True"><Setter Property="Background" Value="#20000000"/></Trigger></Style.Triggers>
        </Style>
        <Style x:Key="ScrollThumb" TargetType="{x:Type Thumb}">
            <Setter Property="OverridesDefaultStyle" Value="true"/><Setter Property="IsTabStop" Value="false"/>
            <Setter Property="Template"><Setter.Value><ControlTemplate TargetType="{x:Type Thumb}"><Border x:Name="rectangle" Background="#808080" CornerRadius="3" Opacity="0.6"/></ControlTemplate></Setter.Value></Setter>
        </Style>
        <Style TargetType="{x:Type ScrollBar}">
            <Setter Property="Stylus.IsPressAndHoldEnabled" Value="false"/><Setter Property="Stylus.IsFlicksEnabled" Value="false"/>
            <Setter Property="Background" Value="Transparent"/><Setter Property="Width" Value="8"/>
            <Setter Property="Template"><Setter.Value><ControlTemplate TargetType="{x:Type ScrollBar}"><Track x:Name="PART_Track" IsDirectionReversed="true" Focusable="false"><Track.Thumb><Thumb Style="{StaticResource ScrollThumb}"/></Track.Thumb></Track></ControlTemplate></Setter.Value></Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Border x:Name="MainBorder" CornerRadius="8" MouseLeftButtonDown="Header_MouseLeftButtonDown">
            <Grid>
                <Grid.RowDefinitions><RowDefinition Height="40"/><RowDefinition Height="*"/><RowDefinition Height="25"/></Grid.RowDefinitions>
                <Border x:Name="HeaderBorder" Grid.Row="0" Background="#FFF5E1" CornerRadius="8,8,0,0">
                    <Grid>
                        <!-- FIXED: Added TextChanged event handler -->
                        <TextBox x:Name="TitleTextBox" Text="My Note" FontSize="14" FontWeight="SemiBold"
                                 Background="Transparent" BorderThickness="0" Foreground="#333"
                                 VerticalAlignment="Center" Margin="12,0,0,0" TextChanged="TitleTextBox_TextChanged"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button x:Name="ColorButton" Content="🎨" Click="ColorButton_Click" Style="{StaticResource HeaderButtonStyle}"/>
                            <Button x:Name="PinButton" Content="📌" Click="PinButton_Click" Style="{StaticResource HeaderButtonStyle}"/>
                            <Button x:Name="CloseButton" Content="✕" Click="CloseButton_Click" Style="{StaticResource HeaderButtonStyle}"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <Border x:Name="BodyBorder" Grid.Row="1" Background="#FFFDF6" Padding="12,12,5,12">
                    <TextBox x:Name="BodyTextBox" AcceptsReturn="True" TextWrapping="Wrap" Background="Transparent" BorderThickness="0" Foreground="#333" VerticalScrollBarVisibility="Auto" Text="Hello world!"/>
                </Border>
                <Border x:Name="FooterBorder" Grid.Row="2" Background="#FFFDF6" CornerRadius="0,0,8,8">
                    <ResizeGrip x:Name="ResizeGrip" HorizontalAlignment="Right" VerticalAlignment="Bottom" Foreground="#A0A0A0" Opacity="0.5"/>
                </Border>
            </Grid>
        </Border>
        <Grid x:Name="IconView" Visibility="Collapsed" Width="44" Height="44" Cursor="Hand" MouseLeftButtonDown="IconView_MouseLeftButtonDown" MouseMove="IconView_MouseMove" MouseLeftButtonUp="IconView_MouseLeftButtonUp">
            <Ellipse x:Name="IconBackground" Fill="#FFF5E1" Opacity="0.8" Stroke="#E0D2B7" StrokeThickness="1"/>
            <TextBlock Text="📝" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False"/>
            <Grid.RenderTransform><TranslateTransform/></Grid.RenderTransform>
        </Grid>
    </Grid>
</Window>